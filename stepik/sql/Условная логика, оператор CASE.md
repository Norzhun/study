
Под условной логикой понимается наличие у программы нескольких путей выполнения в зависимости от каких-то условий.

Например, в базе данных «Расписание» есть таблица Student с полем birthday, отражающим дату рождения студента. Допустим, в выборке необходимо отобразить не саму дату рождения, а текстовое значение «Совершеннолетний» или «Несовершеннолетний» в зависимости от того, есть ли студенту 18 лет. Это и есть пример условной логики, при которой должно вывестись либо одно значение, либо другое в зависимости от конкретного условия.

Реализация такого запроса с помощью CASE может выглядеть следующим образом:

```sql
SELECT first_name, last_name,
CASE
  WHEN TIMESTAMPDIFF(YEAR, birthday, NOW()) >= 18 THEN "Совершеннолетний"
  ELSE "Несовершеннолетний"
END AS status
FROM Student
```
## Синтаксис поискового выражения CASE
```sql
CASE
    WHEN условие_1 THEN возвращаемое_значение_1
    WHEN условие_2 THEN возвращаемое_значение_2
    WHEN условие_n THEN возвращаемое_значение_n
    [ELSE возвращаемое_значение_по_умолчанию]
END
```

Если условие_1 возвращает истинное значение, то выражение CASE вернёт возвращаемое_значение_1, иначе будет сделана проверка на условие_2 и т.д. Если ни одно из предложенных условий не будет выполнено, то вернётся NULL или возвращаемое_значение_по_умолчанию, если была использована конструкция ELSE.

### Пример
Рассмотрим оператор CASE на примере определения этапа школьного образования.
```sql
SELECT name,
CASE
  WHEN SUBSTRING(name, 1, INSTR(name, ' ')) IN (10, 11) THEN "Старшая школа"
  WHEN SUBSTRING(name, 1, INSTR(name, ' ')) IN (5, 6, 7, 8, 9) THEN "Средняя школа"
  ELSE "Начальная школа"
END AS stage
FROM Class
```
- Сначала мы извлекаем номер класса из его названия

    ```sql
    SUBSTRING(name, 1, INSTR(name, ' '))
    ```
- Далее мы проверяем вхождение данного номера в список классов, относящихся к «Старшая школа» и «Средняя школа».
- Если номер класса не находится в диапазоне 5–11, мы выводим «Начальная школа».
## Синтаксис простого выражения CASE

Оператор CASE также имеет и более простой синтаксис, который схож с поисковым выражением CASE, но является менее гибким. Так он выглядит в общем виде:
```sql
CASE значение
    WHEN сравниваемое_значение_1 THEN возвращаемое_значение_1
    WHEN сравниваемое_значение_2 THEN возвращаемое_значение_2
    WHEN сравниваемое_значение_n THEN возвращаемое_значение_n
    [ELSE возвращаемое_значение_по-умолчанию]
END
```

В этом синтаксисе значение в CASE поочерёдно сравнивается с переданными значениями в WHEN и при совпадении возвращается значение следующее за THEN.

Используя этот синтаксис, можно переписать наш предыдущий пример таким образом:

MySQL

```sql
SELECT name,
CASE SUBSTRING(name, 1, INSTR(name, ' '))
  WHEN 11 THEN "Старшая школа"
  WHEN 10 THEN "Старшая школа"
  WHEN 9 THEN "Средняя школа"
  WHEN 8 THEN "Средняя школа"
  WHEN 7 THEN "Средняя школа"
  WHEN 6 THEN "Средняя школа"
  WHEN 5 THEN "Средняя школа"
  ELSE "Начальная школа"
END AS stage
FROM Class
```

# Условная функция IF

```sql
IF(условное_выражение, значение_1, значение_2);
```

Если условное выражение, передаваемое в качестве первого аргумента в функцию IF, истинно, функция вернёт значение второго аргумента значение_1, иначе возвращается значение третьего аргумента значение_2.

### Примеры

- Простое сравнение двух чисел. Так как 10 не больше 20, функция вернёт "FALSE".

    ```sql
    SELECT IF(10 > 20, "TRUE", "FALSE");
    ```
Пример использования с реальной БД. Необходимо на основании цены определить принадлежность жилья к одному из двух классов: "Комфорт-класс" и "Эконом-класс". Если цена больше или равна 150, то это жильё относится к "Комфорт-класс".
```sql
SELECT id, price,
    IF(price >= 150, "Комфорт-класс", "Эконом-класс") AS category
    FROM Rooms
```
Функции IF можно также вкладывать друг в друга, эмулируя оператор CASE.
```sql
SELECT id, price,
    IF(price >= 200, "Бизнес-класс",
        IF(price >= 150,
            "Комфорт-класс", "Эконом-класс")) AS category
    FROM Rooms
```
## Функции IFNULL и NULLIF

Помимо функции IF, в SQL также есть более простые, но менее универсальные функции IFNULL и NULLIF, направленные на обработку NULL значений.

### Синтаксис IFNULL

```sql
IFNULL(значение, альтернативное_значение);
```

Функция IFNULL возвращает значение, переданное первым аргументом, если оно не равно NULL, иначе возвращает альтернативное_значение.

- Если первый аргумент не равен NULL, то вернётся именно он.

    ```sql
    SELECT IFNULL("SQL Academy", "Альтернатива SQL Academy") AS sql_trainer;
    ```

- Если первый аргумент равен NULL, то вернётся значение, переданное вторым аргументом.

    ```sql
    SELECT IFNULL(NULL, "Альтернатива SQL Academy") AS sql_trainer;
    ```


### Синтаксис NULLIF

```sql
NULLIF(значение_1, значение_2);
```

Функция NULLIF возвращает NULL, если значение_1 равно значению_2, в противном случае возвращает значение_1.

- Если значение первого аргумента равно значению второго аргумента, то возвращается NULL.
 
    ```sql
    SELECT NULLIF("SQL Academy", "SQL Academy") AS sql_trainer;
    ```

- Если значения первого и второго аргумента различаются, то возвращается значение первого аргумента.

    ```sql
    SELECT NULLIF("SQL Academy", "Альтернатива SQL Academy") AS sql_trainer;
    ```
	